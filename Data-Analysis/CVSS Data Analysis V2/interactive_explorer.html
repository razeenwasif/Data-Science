<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive CVSS Vulnerability Cluster Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals with Subtle Accents -->
    <!-- Application Structure Plan: A dashboard-style layout with three main columns. The left column provides an overview and primary controls (cluster selection). The central column displays the main 2D scatter plot of all vulnerability clusters. The right column is a dynamic "deep dive" panel that updates with detailed statistics and a radar chart for the selected cluster. This structure was chosen to facilitate an intuitive user flow: get an overview, select a point of interest, and then explore its specific details without leaving the page, which is ideal for risk analysis and comparison. -->
    <!-- Visualization & Content Choices: 
        - Overview: Bar chart for cluster sizes (Goal: Compare, Method: Chart.js Bar). Simple, effective for showing magnitude.
        - Main Viz: Scatter plot for PCA-reduced data (Goal: Organize/Relationships, Method: Chart.js Scatter). Best for showing spatial distribution and density of the identified clusters.
        - Deep Dive Stats: Dynamic text blocks (Goal: Inform, Method: JS update). For clear, immediate communication of key metrics like mean base score.
        - Deep Dive Profile: Radar chart for CVSS metric distribution (Goal: Compare/Inform, Method: Chart.js Radar). Chosen because it provides a powerful visual "fingerprint" of a cluster's multi-dimensional characteristics (e.g., attack vector, complexity), which is more intuitive for comparison than multiple bar charts.
        - Interaction: Click-to-filter/highlight. A simple, direct interaction that connects all visual elements, reinforcing the relationship between the overview, the whole dataset, and the detailed view.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
            color: #4a4a4a;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 40vh;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 50vh;
            }
        }
        .active-cluster-btn {
            background-color: #4a5568 !important;
            color: #ffffff !important;
            border-color: #4a5568 !important;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Interactive CVSS Vulnerability Cluster Explorer</h1>
            <p class="mt-2 text-lg text-gray-600">An analytical tool for risk-based software procurement decisions.</p>
        </header>

        <main>
            <section id="overview" class="bg-white p-6 rounded-lg shadow-md mb-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-3">Analysis Overview</h2>
                <p class="text-gray-600 leading-relaxed">
                    This dashboard presents the results of an unsupervised learning analysis on the Common Vulnerability Scoring System (CVSS) dataset. Using K-Means clustering, 9,210 vulnerabilities were grouped into five distinct clusters based on their inherent characteristics (like attack vector and impact), independent of their pre-assigned severity scores. The purpose is to provide a data-driven framework for assessing the risk profile of software. Select a cluster below to explore its specific characteristics and understand the typical nature of vulnerabilities within that group.
                </p>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <aside class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Cluster Control Panel</h3>
                    <div id="cluster-buttons" class="space-y-3 mb-6">
                        <!-- Buttons will be generated by JS -->
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700 mb-3">Vulnerabilities per Cluster</h4>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="clusterSizeChart"></canvas>
                        </div>
                    </div>
                </aside>

                <section class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="md:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">Vulnerability Distribution (PCA)</h3>
                        <div class="chart-container">
                            <canvas id="scatterChart"></canvas>
                        </div>
                    </div>
                    <div id="deep-dive-panel" class="md:col-span-2 bg-white p-6 rounded-lg shadow-md transition-all duration-300">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">Cluster Deep Dive: <span id="cluster-title" class="text-indigo-600">All Clusters</span></h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-6 text-center">
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-gray-500">Total Vulnerabilities</p>
                                <p id="vulnerability-count" class="text-2xl font-bold text-gray-800">9,210</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-gray-500">Mean Base Score</p>
                                <p id="mean-score" class="text-2xl font-bold text-gray-800">7.15</p>
                            </div>
                             <div class="bg-gray-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-gray-500">Dominant Profile</p>
                                <p id="dominant-profile" class="text-lg font-semibold text-gray-800 pt-2">Overall Mix</p>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-gray-700 mb-3">Characteristic Profile</h4>
                            <div class="chart-container" style="height: 350px; max-height: 350px;">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <footer class="text-center mt-12 text-gray-500">
                <p>This interactive report is based on the "Data Analysis Report: CVSS Unsupervised Learning".</p>
            </footer>
        </main>
    </div>

    <script>
        const reportData = {
            totalVulnerabilities: 9210,
            clusters: [
                { id: 0, name: "High Impact / Network", size: 3358, meanScore: 9.01, color: 'rgba(239, 68, 68, 0.6)', borderColor: 'rgba(239, 68, 68, 1)' },
                { id: 1, name: "Low Impact / Local", size: 674, meanScore: 5.02, color: 'rgba(59, 130, 246, 0.6)', borderColor: 'rgba(59, 130, 246, 1)' },
                { id: 2, name: "Scope Change / Low Impact", size: 2342, meanScore: 5.65, color: 'rgba(16, 185, 129, 0.6)', borderColor: 'rgba(16, 185, 129, 1)' },
                { id: 3, name: "High Impact / Local", size: 895, meanScore: 7.39, color: 'rgba(245, 158, 11, 0.6)', borderColor: 'rgba(245, 158, 11, 1)' },
                { id: 4, name: "Medium Impact / Network", size: 1941, meanScore: 6.66, color: 'rgba(139, 92, 246, 0.6)', borderColor: 'rgba(139, 92, 246, 1)' }
            ],
            // CVSS Metrics: AV, AC, PR, UI, S, C, I, A (Normalized for radar chart)
            // Values are means for each cluster from the report (e.g., NETWORK=0.85, LOW=0.77...)
            // To make the radar chart more intuitive, we'll use a scale of 0-1 where higher is "more severe" or "more likely".
            // For Scope, 1 is 'Changed' (more severe).
            // For AC, we'll invert it: High complexity (0.44) becomes 1-0.44 = 0.56 (less easy), Low (0.77) becomes 1-0.77=0.23 (more easy). Let's represent "Ease of Attack" instead.
            // For PR, we'll invert it: None (0.85) -> 0.15, Low (0.62) -> 0.38, High (0.27) -> 0.73. Let's call it "Privilege Requirement".
            // For UI, we'll invert it: None (0.85) -> 0.15, Required (0.62) -> 0.38. Let's call it "User Interaction Needed".
            radarMetrics: {
                labels: ['Attack Vector', 'Attack Complexity', 'Privileges Required', 'User Interaction', 'Scope Change', 'Confidentiality', 'Integrity', 'Availability'],
                clusters: [
                    { id: 0, data: [0.79, 0.75, 0.81, 0.77, 0.04, 0.56, 0.55, 0.55] }, // High Impact / Network
                    { id: 1, data: [0.63, 0.75, 0.54, 0.85, 0.08, 0.26, 0.05, 0.21] }, // Low Impact / Local
                    { id: 2, data: [0.85, 0.77, 0.74, 0.62, 0.95, 0.22, 0.22, 0.00] }, // Scope Change / Low Impact
                    { id: 3, data: [0.61, 0.74, 0.50, 0.85, 0.03, 0.55, 0.54, 0.55] }, // High Impact / Local
                    { id: 4, data: [0.79, 0.75, 0.82, 0.79, 0.04, 0.24, 0.08, 0.24] }  // Medium Impact / Network
                ]
            },
            // Mock PCA data - this should be replaced with real data if available
            // Generating plausible random data that forms 5 clusters for visualization
            scatterData: [] 
        };

        // Generate mock scatter data
        function generateClusterData(n, cx, cy, radius, clusterId) {
            const points = [];
            for (let i = 0; i < n; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const r = radius * Math.sqrt(Math.random());
                points.push({
                    x: cx + r * Math.cos(angle),
                    y: cy + r * Math.sin(angle),
                    cluster: clusterId
                });
            }
            return points;
        }

        const clusterCenters = [ {x: 4, y: 4}, {x: -3, y: -4}, {x: 5, y: -3}, {x: -4, y: 3}, {x: 0, y: 0} ];
        reportData.clusters.forEach((cluster, i) => {
            const center = clusterCenters[i];
            reportData.scatterData.push(...generateClusterData(cluster.size / 10, center.x, center.y, 2.5, cluster.id));
        });


        // --- UI Elements ---
        const clusterButtonsContainer = document.getElementById('cluster-buttons');
        const clusterTitle = document.getElementById('cluster-title');
        const vulnerabilityCount = document.getElementById('vulnerability-count');
        const meanScore = document.getElementById('mean-score');
        const dominantProfile = document.getElementById('dominant-profile');

        // --- Chart Instances ---
        let clusterSizeChart, scatterChart, radarChart;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            createClusterButtons();
            createClusterSizeChart();
            createScatterChart();
            createRadarChart();
            updateDashboard(-1); // Initial view for all clusters
        });

        function createClusterButtons() {
            const allButton = document.createElement('button');
            allButton.textContent = 'Show All Clusters';
            allButton.className = 'w-full text-left p-3 border rounded-lg hover:bg-gray-100 transition active-cluster-btn';
            allButton.onclick = () => updateDashboard(-1);
            clusterButtonsContainer.appendChild(allButton);

            reportData.clusters.forEach(cluster => {
                const button = document.createElement('button');
                button.textContent = `Cluster ${cluster.id}: ${cluster.name}`;
                button.className = 'w-full text-left p-3 border rounded-lg hover:bg-gray-100 transition';
                button.style.borderColor = cluster.borderColor;
                button.onclick = () => updateDashboard(cluster.id);
                clusterButtonsContainer.appendChild(button);
            });
        }

        function createClusterSizeChart() {
            const ctx = document.getElementById('clusterSizeChart').getContext('2d');
            clusterSizeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: reportData.clusters.map(c => `Cluster ${c.id}`),
                    datasets: [{
                        label: 'Number of Vulnerabilities',
                        data: reportData.clusters.map(c => c.size),
                        backgroundColor: reportData.clusters.map(c => c.color),
                        borderColor: reportData.clusters.map(c => c.borderColor),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.dataset.label}: ${context.raw.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => value.toLocaleString()
                            }
                        }
                    }
                }
            });
        }

        function createScatterChart() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: reportData.clusters.map(cluster => ({
                        label: `Cluster ${cluster.id}`,
                        data: reportData.scatterData.filter(p => p.cluster === cluster.id),
                        backgroundColor: cluster.color,
                        pointRadius: 4,
                        pointHoverRadius: 7
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                             callbacks: {
                                label: (context) => `Vulnerability Point, Cluster ${context.dataset.label.split(' ')[1]}`
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Principal Component 1' } },
                        y: { title: { display: true, text: 'Principal Component 2' } }
                    }
                }
            });
        }

        function createRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: reportData.radarMetrics.labels,
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: { borderWidth: 2 }
                    },
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 1,
                            pointLabels: { font: { size: 11 } }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function updateDashboard(clusterId) {
            // Update buttons
            const buttons = clusterButtonsContainer.querySelectorAll('button');
            buttons.forEach((btn, index) => {
                if (index - 1 === clusterId) {
                    btn.classList.add('active-cluster-btn');
                } else {
                    btn.classList.remove('active-cluster-btn');
                }
            });
            if (clusterId === -1) buttons[0].classList.add('active-cluster-btn');

            // Update deep dive panel
            if (clusterId === -1) {
                const totalScore = reportData.clusters.reduce((acc, c) => acc + c.meanScore * c.size, 0);
                clusterTitle.textContent = 'All Clusters';
                vulnerabilityCount.textContent = reportData.totalVulnerabilities.toLocaleString();
                meanScore.textContent = (totalScore / reportData.totalVulnerabilities).toFixed(2);
                dominantProfile.textContent = 'Overall Mix';
            } else {
                const cluster = reportData.clusters[clusterId];
                clusterTitle.textContent = `Cluster ${cluster.id}: ${cluster.name}`;
                vulnerabilityCount.textContent = cluster.size.toLocaleString();
                meanScore.textContent = cluster.meanScore.toFixed(2);
                
                const radarData = reportData.radarMetrics.clusters[clusterId].data;
                const maxIndex = radarData.indexOf(Math.max(...radarData));
                dominantProfile.textContent = reportData.radarMetrics.labels[maxIndex];
            }

            // Update radar chart
            radarChart.data.datasets = [];
            if (clusterId === -1) {
                reportData.clusters.forEach(cluster => {
                    radarChart.data.datasets.push({
                        label: `Cluster ${cluster.id}`,
                        data: reportData.radarMetrics.clusters[cluster.id].data,
                        backgroundColor: cluster.color.replace('0.6', '0.2'),
                        borderColor: cluster.borderColor,
                        pointBackgroundColor: cluster.borderColor,
                    });
                });
            } else {
                const cluster = reportData.clusters[clusterId];
                radarChart.data.datasets.push({
                    label: `Cluster ${cluster.id}`,
                    data: reportData.radarMetrics.clusters[cluster.id].data,
                    backgroundColor: cluster.color.replace('0.6', '0.2'),
                    borderColor: cluster.borderColor,
                    pointBackgroundColor: cluster.borderColor,
                });
            }
            radarChart.update();

            // Update scatter chart opacity
            scatterChart.data.datasets.forEach((dataset, index) => {
                if (clusterId === -1 || index === clusterId) {
                    dataset.backgroundColor = reportData.clusters[index].color;
                    dataset.pointRadius = 4;

                } else {
                    dataset.backgroundColor = 'rgba(200, 200, 200, 0.2)';
                    dataset.pointRadius = 3;
                }
            });
            scatterChart.update();
        }

    </script>
</body>
</html>
